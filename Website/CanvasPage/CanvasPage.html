<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <style>
            body {
              background-color: coral;
            }
            #canvasId {
                background-color: #3A3A3A;
                width: 400px;
                height: 400px;
            }
            #dsCanvasId {
                background-color: #3A3A3A;
                width: 1077px;
                height: 333px;
            }
            .colorButton {
                border-width: 0;
                background-color: transparent;
            }
            .colorButtonImage {
                rotate: 230deg;
                width: 20px;
            }

            .cursorImageStyle {
                position: absolute;
                top: 50px;
                left: 50px;
                width: 30px;
                background-color: transparent;
                draggable: false;
            }

        </style>
        <script>
            "use strict"
            class ImageCursorDef {
                constructor(anImageUrl) {
                    this.imageUrl = anImageUrl;
                }
            }

            const redCursorDef = new ImageCursorDef("../Images/RedPenCursor.png");
            const blueCursorDef = new ImageCursorDef("../Images/BluePenCursor.png");
            const yellowCursorDef = new ImageCursorDef("../Images/YellowPenCursor.png");
            const greenCursorDef = new ImageCursorDef("../Images/GreenPenCursor.png");
            const orangeCursorDef = new ImageCursorDef("../Images/OrangePenCursor.png");
            const purpleCursorDef = new ImageCursorDef("../Images/PurplePenCursor.png");
            const spongeCursorDef = new ImageCursorDef("../Images/SpongeCursor.png");

            let imageCursor;

            let cursorX;
            let cursorY;

            var canvas;
            var ctx;
            var color = "#EBA09E";
            var mustDraw = false;
            var lineWidth = 4;
            var prevX;
            var prevY;
            var currX;
            var currY;

            var dsCanvas;
            var dsContext;
            var dsImage;

            function onloadBody() {
                canvas = document.getElementById('canvasId');
                ctx = canvas.getContext("2d");

                imageCursor = document.getElementById('imageCursor');

                canvas.addEventListener("mousemove", mouseMoveHandler, false);
                canvas.addEventListener("mousedown", mouseDownHandler, false);
                canvas.addEventListener("mouseup", mouseUpHandler, false);
                canvas.addEventListener("mouseout", mouseOutHandler, false);

                dsCanvas = document.getElementById('dsCanvasId');
                dsContext = dsCanvas.getContext("2d");
                dsImage = new Image();
                dsImage.src = "../Images/CitroenDs.png"
                dsImage.onload = () => { dsContext.drawImage(dsImage, 0, 0, 320, 100); };
            }

            function RedPenSelected()
            {
                color = "#EBA09EA0";
                imageCursor.src = redCursorDef.imageUrl;
            }

            function BluePenSelected()
            {
                color = "#81C1DCA0";
                imageCursor.src = blueCursorDef.imageUrl;
            }

            function YellowPenSelected()
            {
                color = "#DDD1A0A0";
                imageCursor.src = yellowCursorDef.imageUrl;
            }

            function GreenPenSelected()
            {
                color = "#A6D3BCA0";
                imageCursor.src = greenCursorDef.imageUrl;
            }

            function OrangePenSelected()
            {
                color = "#E8BB9BA0";
                imageCursor.src = orangeCursorDef.imageUrl;
            }

            function PurplePenSelected()
            {
                color = "#D5B4C7A0";
                imageCursor.src = purpleCursorDef.imageUrl;
            }

            function SpongeSelected()
            {
                color = "#3A3A3AA0";
                imageCursor.src = spongeCursorDef.imageUrl;
            }

            function draw()
            {
                ctx.beginPath();
                ctx.moveTo(prevX, prevY);
                ctx.lineTo(currX, currY);
                ctx.strokeStyle = color;
                ctx.lineWidth = lineWidth;
                ctx.stroke();
                ctx.closePath();
            }

            function getMousePos(canvas, evt) {
                let rect = canvas.getBoundingClientRect(), // abs. size of element
                    scaleX = canvas.width / rect.width,    // relationship bitmap vs. element for x
                    scaleY = canvas.height / rect.height;  // relationship bitmap vs. element for y

                currX = (evt.clientX - rect.left) * scaleX;
                currY = (evt.clientY - rect.top) * scaleY;
                cursorX = (evt.clientX);
                cursorY = (evt.clientY);

                //    alert(
                //        "client rect left:" + rect.left + " right:" + rect.right + " top:" + rect.top + " bottom:" + rect.bottom
                //        + "\ncanvas width:" + canvas.width + " height: " + canvas.height
                //        + "\nScale X:" + scaleX + " scaleY: " + scaleY
                //        + "\nCanvasX:" + currX + " CanvasY: " + currY
                //    );
            }

            function mouseMoveHandler(e)
            {
                prevX = currX;
                prevY = currY;
                if (mustDraw)
                {
                    prevX = currX;
                    prevY = currY;
                    getMousePos(canvas, e)
                    draw();
                    imageCursor.style.left = cursorX + 50 + 'px';
                    imageCursor.style.top = cursorY + 50 + 'px';
                 }
            }

            function mouseOutHandler()
            {
                mustDraw = false;
            }

            function mouseDownHandler(e)
            {
                getMousePos(canvas, e)
                mustDraw = true;
            }

            function mouseUpHandler()
            {
                mustDraw = false;
            }

        </script>
       <title>CanvasPage</title>
    </head>
    <body onLoad="onloadBody()">
        <div>
            <button class="colorButton" onclick="RedPenSelected()">
                <img class="colorButtonImage" src="../Images/RedPen.png" />
            </button>
            <button class="colorButton" onclick="BluePenSelected()">
                <img class="colorButtonImage" src="../Images/BluePen.png" />
            </button>
            <button class="colorButton" onclick="YellowPenSelected()">
                <img class="colorButtonImage" src="../Images/YellowPen.png" />
            </button>
            <button class="colorButton" onclick="GreenPenSelected()">
                <img class="colorButtonImage" src="../Images/GreenPen.png" />
            </button>
            <button class="colorButton" onclick="OrangePenSelected()">
                <img class="colorButtonImage" src="../Images/OrangePen.png" />
            </button>
            <button class="colorButton" onclick="PurplePenSelected()">
                <img class="colorButtonImage" src="../Images/PurplePen.png" />
            </button>
            <button class="colorButton" onclick="SpongeSelected()" width="200">
                <img class="colorButtonImage" src="../Images/Sponge.png" width="150" />
            </button>
        </div>
        <canvas id="canvasId" position="relative">
        </canvas>
        <img id="imageCursor" class="cursorImageStyle" draggable="false" style.position="absolute" top="100" left="300" src="../Images/RedPenCursor.png" />
        <canvas id="dsCanvasId">
        </canvas>

    </body>
</html>